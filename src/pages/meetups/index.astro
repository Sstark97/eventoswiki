---
import Layout from '@/layouts/layout.astro'
import { MeetupsLocator } from '@/meetups/di/meetups.locator'
import { ProvincesLocator } from '@/provinces/di/provinces.locator'
import EventsGrid from '@/ui/components/events-grid/events-grid.astro'
import { Urls } from '@/ui/urls/urls'

const searchParams = new URL(Astro.request.url).searchParams
const page = searchParams.get('page') ? Number(searchParams.get('page')) : 1
const provinceParam = searchParams.get('province')
let province = undefined

if (provinceParam) {
  province = await ProvincesLocator.getProvinceQuery().execute({ id: provinceParam })
}

const { data: meetups, totalPages } = await MeetupsLocator.getNextMeetupsQuery().execute({
  count: 12,
  page,
  location: province?.name,
})
---

<Layout title="eventos.wiki - Meetups" classes="px-4 lg:px-12">
  <EventsGrid
    actionLink={Urls.PAST_MEETUPS}
    actionText="Ver prÃ³ximos"
    title="Meetups"
    events={meetups}
    page={page}
    totalPages={totalPages}
    goToEvent={Urls.MEETUP}
  />
</Layout>
