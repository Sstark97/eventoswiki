---
import PastEventsGrid from '@/events/presentation/server/components/past-events/past-events-grid.astro'
import Layout from '@/layouts/layout.astro'
import { ProvincesLocator } from '@/provinces/di/provinces.locator'
import type { Province } from '@/provinces/domain/province'
import ProvinceComboboxFilter from '@/provinces/presentation/server/components/province-combobox/province-combobox-filter.astro'
import EventsHeader from '@/ui/components/events-header/events-header.astro'
import SearchFiltersBar from '@/ui/components/search-filters-bar/search-filters-bar.astro'
import { Urls } from '@/ui/urls/urls'

const searchParams = new URL(Astro.request.url).searchParams
const page = searchParams.get('page') ? Number(searchParams.get('page')) : 1
const provinceParam = searchParams.get('province')

let province: Province | null = null

if (provinceParam) {
  province = await ProvincesLocator.getProvinceQuery().execute({ id: provinceParam })
}
---

<Layout title="eventos.wiki - Eventos pasados" classes="px-4 lg:px-12">
  <EventsHeader title="Eventos pasados" actionLink={Urls.EVENTS} actionText="Ver prÃ³ximos eventos" transition:persist>
    <SearchFiltersBar>
      <ProvinceComboboxFilter value={province?.slug} />
    </SearchFiltersBar>
  </EventsHeader>
  <PastEventsGrid location={province?.name} page={page} server:defer />
</Layout>
